---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/base-layout.astro';
import Header from '../components/layout/header.astro';
import Footer from '../components/layout/footer.astro';
import PageMain from '../components/layout/page-main.astro';
import PageContainer from '../components/layout/page-container.astro';
import PageHeader from '../components/layout/page-header.astro';
import DotBackground from '../components/ui/dot-background.astro';
import BlogGrid from '../components/blog/blog-grid-wrapper';

const logPosts = await getCollection('log', ({ data }) => {
	return data.draft !== true;
});

// Sort posts by date, newest first
const sortedPosts = logPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Format data for BlogGrid component
const blogData = sortedPosts.map(post => ({
	slug: post.slug,
	title: post.data.title,
	description: post.data.description,
	heroImage: typeof post.data.heroImage === 'string' ? post.data.heroImage : post.data.heroImage?.src,
	pubDate: post.data.pubDate,
	tags: post.data.tags
}));

const isEmpty = blogData.length === 0;
---

<BaseLayout 
	title="Blog | Carlos Garcia | Insights on 3D Art, Tech & Creative Workflows" 
	description="Blog posts, insights, and thoughts on 3D art, technical direction, pipeline development, and creative workflows. Regular updates from Carlos Garcia."
	keywords="3D Art Blog, Technical Art Blog, Pipeline Development, Houdini Tips, Creative Workflows, Artist Insights, Technical Direction"
>
	<Header />
	<PageMain class="text-foreground">
		<DotBackground />
		
		<div class="relative z-10 w-full py-24 sm:py-32">
			<PageContainer>
				<PageHeader
					title="Log"
					description="Thoughts on craft, technical notes, and experiments"
				/>
				
				{isEmpty ? (
					<div class="text-center py-16">
						<p class="text-foreground-muted text-lg">
							No entries yet. Check back soon.
						</p>
					</div>
				) : (
					<BlogGrid posts={blogData} client:load />
				)}
			</PageContainer>
		</div>
	</PageMain>
	<Footer />
</BaseLayout>
