---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/base-layout.astro';
import Header from '../../components/layout/header.astro';
import Footer from '../../components/layout/footer.astro';
import PageMain from '../../components/layout/page-main.astro';
import ContentHero from '../../components/content/content-hero.astro';
import ProseContent from '../../components/content/prose-content.astro';

export async function getStaticPaths() {
  const posts = await getCollection('log', ({ data }) => {
    return data.draft !== true;
  });
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

// Format metadata
const formattedDate = post.data.pubDate 
  ? new Date(post.data.pubDate).toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    })
  : '';
const meta = formattedDate ? `on ${formattedDate}` : '';
---

<BaseLayout
  title={`${post.data.title} | Blog | Carlos Garcia`}
  description={post.data.description}
  image={post.data.heroImage?.src}
  type="article"
>
  <Header />
  <PageMain>
    <ContentHero
      title={post.data.title}
      description={post.data.description}
      meta={meta}
      heroImage={post.data.heroImage}
    />
    <ProseContent>
      <Content />
    </ProseContent>
  </PageMain>
  <Footer />
</BaseLayout>
